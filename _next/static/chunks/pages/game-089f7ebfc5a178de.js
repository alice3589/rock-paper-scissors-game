(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[203],{3874:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/game",function(){return t(87)}])},87:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return a}});var n=t(5893),s=t(7294),o=t(1163),i=t(9211);function a(){let e=(0,o.useRouter)(),r=(0,s.useRef)(null),[t,a]=(0,s.useState)(null),[l,c]=(0,s.useState)(!0),[d,u]=(0,s.useState)(null),[m,h]=(0,s.useState)(null),[f,p]=(0,s.useState)(!1),[g,x]=(0,s.useState)(1),[j,b]=(0,s.useState)(0),[v,y]=(0,s.useState)(0),[w,D]=(0,s.useState)("playing"),[k,N]=(0,s.useState)(null),[E,S]=(0,s.useState)(null);(0,s.useEffect)(()=>{{let e=setTimeout(()=>{z()},100);return()=>{if(clearTimeout(e),r.current){let e=r.current.srcObject;e&&e.getTracks().forEach(e=>e.stop())}}}},[]);let z=async()=>{try{let t=e.basePath||"",n="".concat(t,"/model"),s=n+"/model.json",o=n+"/metadata.json";console.log("Loading model from:",s),console.log("Metadata URL:",o);try{let e=await fetch(o);if(!e.ok)throw Error("Metadata file not found: ".concat(e.status));let r=await e.json();console.log("Metadata loaded:",r)}catch(e){throw console.error("Error fetching metadata:",e),Error("メタデータファイルの読み込みに失敗しました: ".concat(o))}let l=await i.zD(s,o);if(console.log("Model loaded successfully"),a(l),!r.current)throw Error("ビデオ要素がまだマウントされていません");if(!r.current)throw Error("ビデオ要素が見つかりません");if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){let e=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480}});if(r.current)r.current.srcObject=e,await r.current.play(),c(!1),_(l);else throw e.getTracks().forEach(e=>e.stop()),Error("ビデオ要素が利用できなくなりました")}else throw Error("カメラ機能が利用できません")}catch(e){console.error("Error loading model or camera:",e),console.error("Error details:",{message:e.message,stack:e.stack,name:e.name}),alert("エラーが発生しました: ".concat(e.message,"\n\nコンソールに詳細なエラー情報が表示されています。")),c(!1)}},T=e=>({rock:"グー",paper:"パー",scissors:"チョキ",none:"検出中..."})[e]||e,_=async e=>{if(!e||!r.current||f)return;p(!0);let t=(await e.predict(r.current)).sort((e,r)=>r.probability-e.probability),n=t[0],s="none";if(n&&n.probability>=.7){let e=e=>({グー:"rock",チョキ:"scissors",パー:"paper",何もなし:"none",rock:"rock",paper:"paper",scissors:"scissors",none:"none"})[e]||e,r=t.map(r=>({...r,normalizedLabel:e(r.className)})).find(e=>"none"!==e.normalizedLabel&&e.probability>=.7);r&&(s=r.normalizedLabel)}"none"!==s&&h(s),u("none"===s?"検出中...":s),p(!1),requestAnimationFrame(()=>_(e))},C=e=>{switch(e){case"rock":case"グー":return"✊";case"paper":case"パー":return"\uD83D\uDD90";case"scissors":case"チョキ":return"✌";default:return"❓"}},M=()=>{let e=["rock","paper","scissors"];return e[Math.floor(Math.random()*e.length)]},F=(e,r)=>e===r?"draw":"rock"===e&&"scissors"===r||"paper"===e&&"rock"===r||"scissors"===e&&"paper"===r?"win":"lose",L=e=>{var r;let t=null!==(r=null==e?void 0:e.force)&&void 0!==r&&r,n=d&&"検出中..."!==d&&"none"!==d;if(!t&&!n){alert("手の形を認識できません。もう一度試してください。");return}let s=M(),o=F(n?d:m||"rock",s),i=j+("win"===o?1:0),a=v+("lose"===o?1:0);N(s),S(o),b(i),y(a),g>=3?setTimeout(()=>{i>a?D("won"):i<a?D("lost"):D("draw")},1500):x(g+1)};return(0,n.jsxs)("div",{className:"container",children:[(0,n.jsx)("h1",{style:{textAlign:"center",marginBottom:"1rem"},children:"ジャンケンゲーム"}),(0,n.jsx)("video",{ref:r,className:"video",autoPlay:!0,playsInline:!0,muted:!0,style:{display:l||"playing"!==w?"none":"block",width:"100%",borderRadius:"15px",transform:"scaleX(-1)"}}),l?(0,n.jsx)("div",{className:"loading",children:(0,n.jsx)("p",{children:"モデルとカメラを読み込み中..."})}):"playing"!==w?(0,n.jsxs)("div",{className:"result-screen",children:[(0,n.jsxs)("h2",{children:["won"===w&&"\uD83C\uDF89 あなたの勝ち！","lost"===w&&"\uD83D\uDE22 あなたの負け...","draw"===w&&"\uD83E\uDD1D 引き分け！"]}),(0,n.jsxs)("div",{style:{fontSize:"1.5rem",marginTop:"1rem"},children:[(0,n.jsxs)("p",{children:["あなた: ",j,"点"]}),(0,n.jsxs)("p",{children:["コンピュータ: ",v,"点"]})]}),(0,n.jsx)("button",{className:"button",onClick:()=>{x(1),b(0),y(0),D("playing"),N(null),S(null),h(null)},style:{marginTop:"2rem"},children:"もう一度遊ぶ"}),(0,n.jsx)("button",{className:"button",onClick:()=>e.push("/"),style:{marginTop:"1rem"},children:"ホームに戻る"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"score-board",children:[(0,n.jsxs)("div",{className:"score-item",children:[(0,n.jsx)("div",{children:"あなた"}),(0,n.jsx)("div",{style:{fontSize:"2rem",fontWeight:"bold"},children:j})]}),(0,n.jsx)("div",{className:"score-item",children:(0,n.jsxs)("div",{children:["ラウンド ",g," / 3"]})}),(0,n.jsxs)("div",{className:"score-item",children:[(0,n.jsx)("div",{children:"コンピュータ"}),(0,n.jsx)("div",{style:{fontSize:"2rem",fontWeight:"bold"},children:v})]})]}),(0,n.jsx)("div",{className:"camera-container",children:(0,n.jsxs)("div",{className:"prediction-box",children:[(0,n.jsx)("div",{style:{fontSize:"0.9rem",marginBottom:"0.5rem"},children:"あなたの手:"}),(0,n.jsx)("div",{style:{fontSize:"1.5rem",fontWeight:"bold"},children:d&&"検出中..."!==d?(0,n.jsxs)(n.Fragment,{children:[C(d)," ",T(d)]}):"検出中..."})]})}),E&&(0,n.jsxs)("div",{className:"round-result",children:[(0,n.jsxs)("div",{style:{fontSize:"1.2rem",marginBottom:"1rem"},children:["コンピュータ: ",C(k)," ",T(k)]}),(0,n.jsxs)("div",{style:{fontSize:"1.5rem",fontWeight:"bold"},children:["win"===E&&"\uD83C\uDF89 あなたの勝ち！","lose"===E&&"\uD83D\uDE22 あなたの負け...","draw"===E&&"\uD83E\uDD1D 引き分け！"]})]}),(0,n.jsxs)("div",{style:{textAlign:"center",marginTop:"2rem",display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem"},children:[(0,n.jsx)("button",{className:"button",onClick:()=>L(),disabled:!d||"検出中..."===d||"none"===d||null!==E,style:{fontSize:"1.2rem",padding:"1rem 2rem"},children:"決定！"}),(0,n.jsx)("button",{className:"button",onClick:()=>L({force:!0}),disabled:null!==E,style:{fontSize:"1.1rem",padding:"0.8rem 1.8rem"},children:"結果を表示"})]}),E&&(0,n.jsx)("div",{style:{textAlign:"center",marginTop:"1rem"},children:(0,n.jsx)("button",{className:"button",onClick:()=>S(null),children:"次のラウンドへ"})})]})]})}},914:function(){},5410:function(){},8628:function(){},5778:function(){},1601:function(){},7792:function(){},4977:function(){},5042:function(){}},function(e){e.O(0,[864,904,295,723,974,132,773,589,888,774,179],function(){return e(e.s=3874)}),_N_E=e.O()}]);